<!DOCTYPE html>
<html>
<head>
    <title>release-tracking-with-filters-1.0.0</title>
    <!--  (c) 2017 CA Technologies.  All Rights Reserved. -->
    <!--  Build Date: Mon Dec 31 2018 22:55:40 GMT+0000 (UTC) -->

    <script type="text/javascript">
        var APP_BUILD_DATE = "Mon Dec 31 2018 22:55:40 GMT+0000 (UTC)";
        var CHECKSUM = 97578369829;
    </script>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>
    <!-- our highcharts (needed so that we can add patterns)
    <script type="text/javascript" src="/apps/2.1/lib/analytics/analytics-all.js"></script>
    -->


    <script type="text/javascript">
        Rally.onReady(function() {
            Rally.ui.renderer.GridEditorFactory.editorRenderers.PreliminaryEstimate=function(a){return{xtype:"rallyrecordcontexteditor",field:{xtype:"rallycombobox",allowNoEntry:!a.required,editable:!1,name:a.name,storeConfig:{autoLoad:!0,model:a.name,remoteFilter:!0,sorters:[{property:"Value"}],listeners:{load:function(){}}}}}},Ext.define("Utils.AncestorPiInlineFilter",{override:"Rally.ui.inlinefilter.QuickFilterPanel",portfolioItemTypes:[],modelName:void 0,customFilterNamePrefix:"AncestorPiInlineFilter.",_hasPiAncestor:function(a){return _.contains(["hierarchicalrequirement","userstory","defect"],a)||Ext.String.startsWith(a,"portfolioitem")},_pisAbove:function(a){var b=[];if(_.contains(["hierarchicalrequirement","userstory","defect"],a))b=this.portfolioItemTypes;else if(Ext.String.startsWith(a,"portfolioitem")){var c=_.findIndex(this.portfolioItemTypes,function(b){return b.get("TypePath").toLowerCase()===a});c>=0&&c<this.portfolioItemTypes.length-1&&(b=this.portfolioItemTypes.slice(c+1))}return b},initComponent:function(){this.dataContext||(this.dataContext=Rally.getApp().getContext().getDataContext()),this.modelName&&(this.modelName=this.modelName.toLowerCase());var a={},b=[];if(this._hasPiAncestor(this.modelName)){var c=this._pisAbove(this.modelName);_.each(c,function(d){var e=d.get("TypePath"),f=this.customFilterNamePrefix+e,g="Portfolio Item / "+d.get("Name");a[f]={xtype:"ancestorpisearchcombobox",portfolioItemType:e,piTypesAbove:c,artifactTypeName:this.modelName,storeConfig:{context:this.dataContext,models:e,autoLoad:!0},allowNoEntry:!0,noEntryValue:null,noEntryText:"No "+g,emptyText:"Search "+g+"s...",allowClear:!1,valueField:"ObjectUUID"},b.push({name:f,displayName:g})},this),_.merge(this.addQuickFilterConfig,{additionalFields:b},function(a,b){return _.isArray(a)?_.uniq(a.concat(b),"name"):void 0}),Ext.override(Rally.ui.inlinefilter.FilterFieldFactory,a)}this.callParent(arguments)},_createFields:function(){this.fields=_.filter(this.fields,function(a){return this._filterInvalidAncestorFilters(a)},this),this.initialFilters=_.filter(this.initialFilters,function(a){return this._filterInvalidAncestorFilters(a.name)},this),this.callParent(arguments)},_filterInvalidAncestorFilters:function(a){return!Ext.String.startsWith(a,this.customFilterNamePrefix)||Rally.ui.inlinefilter.FilterFieldFactory.hasOwnProperty(a)}}),Ext.define("Utils.AncestorPiSearchComboBox",{alias:"widget.ancestorpisearchcombobox",extend:"Rally.ui.combobox.ArtifactSearchComboBox",parentField:"PortfolioItem.Parent.",artifactTypeName:void 0,piTypesAbove:[],statics:{UUID_REGEX:/([a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12})/},initComponent:function(){this.storeConfig.filters=[],this.value&&(this.storeConfig.filters=[{property:this.valueField,value:this.value}]),this.callParent(arguments)},getFilter:function(){var a=this.lastValue,b=this.propertyPrefix(),c=[];return a&&this.statics().UUID_REGEX.test(a)?c.push({property:b+".ObjectUUID",value:a}):c.push({property:b,value:null}),Rally.data.wsapi.Filter.or(c)},propertyPrefix:function(){var a;return"hierarchicalrequirement"===this.artifactTypeName||"userstory"===this.artifactTypeName?a=this.piTypesAbove[0].get("Name"):"defect"===this.artifactTypeName?a="Requirement."+this.piTypesAbove[0].get("Name"):Ext.String.startsWith(this.artifactTypeName,"portfolioitem")&&(a="Parent"),a&&_.forEach(this.piTypesAbove,function(b){return b.get("TypePath").toLowerCase()==this.portfolioItemType.toLowerCase()?!1:void(a+=".Parent")},this),a}}),Ext.override(Rally.ui.gridboard.SharedViewComboBox,{_isViewPreference:function(a){return"preference"===a.self.typePath&&"View"===a.get("Type")&&a.get("AppId")==this.getContext().getAppId()},getSharedViewParam:function(){var a=parent.location.hash,b=a.match(/sharedViewId=(\d+)/);return b&&b[1]},_ensureLatestView:function(a){if(a.objectId&&a.versionId){var b=Ext.create("Deft.Deferred");this.store.model.load(a.objectId,{fetch:["VersionId","Value"],success:function(a){b.resolve(a)}}),this.store.on("load",function(){b.promise.then({success:function(b){b&&b.get("VersionId")!==a.versionId&&this._applyView(this._decodeValue(b))},scope:this})},this,{single:!0})}}}),Ext.define("Constants",{statics:{FEATURE_FETCH:["ObjectID","FormattedID","Name","PercentDoneByStoryCount","PercentDoneByStoryPlanEstimate","Project","DisplayColor","Predecessors","Successors"],STORIES_FETCH:["ObjectID","FormattedID","Name","Iteration","Project","StartDate","EndDate","Predecessors","Successors","AcceptedDate"],STORY_COLUMNS:["FormattedID","Name","PlanEstimate","ScheduleState"],RELEASE_CONTROL_LABEL:"Release Tracking",RELEASE_CONTROL_LABEL_CLASS:"ts-page-label",UNSCHEDULED:"Unscheduled",START_DATE:"Iterations from",END_DATE:"to",PORTFOLIO_ITEMS:"Portfolio Items"}}),Ext.define("FeatureStoriesDependenciesPopover",{extend:Rally.ui.popover.DependenciesPopover,titleIconCls:null,title:"Stories With Dependencies",constructor:function(a){var b=0,c=0;return _.each(a.stories,function(a){var d=a.get("PredecessorsAndSuccessors");return d&&(b+=d.Predecessors,c+=d.Successors),b||c?!1:void 0},this),a.items=[{xtype:"tabpanel",activeTab:0===b&&c>0?1:0,items:[{title:"Predecessors",html:"Loading...",tabConfig:{width:160}},{title:"Successors",html:"Loading...",tabConfig:{width:160}}],listeners:{afterRender:this._onAfterRender,tabChange:this._onAfterRender,scope:this}}],this.loaded={},this.superclass.superclass.constructor.apply(this,arguments)},_loadData:function(a){var b=_.map(this.stories,function(b){return b.getCollection(a,{fetch:this.fetchFields[this._getType(b)],requester:this}).load().then({scope:this,success:function(c){return b.get(a).Stories=c,b}})},this);Deft.promise.Promise.all(b).then({scope:this,success:this._onDataRetrieved})},_buildContent:function(a){var b=[],c=this._getTabPanel().getActiveTab().title;return _.each(a,function(a){a.tplType=this._getType(a);var d=a.get(c).Stories;d&&d.length&&(b.push(this.rowTpl.apply(a)),_.each(d,function(a){a.set("_dependencyType",c),b.push(this.depRowTpl.apply(a))},this))},this),'<div class="outer-container">'+b.join("\n")+"</div>"},rowTpl:Ext.create("Ext.XTemplate",'<div class="dependency-row">','<div class="identifier">','{[this.getFormattedIdTemplate(values.data)]} <span class="object-name dependency-title">{[this.trimText(values.data, 40, "")]}</span>',"</div>",'<div class="status">','<tpl if="this.isUserStory(values)">',"{[this.getScheduleState(values)]}","</div>",'<span class="field-label">Iteration:</span> <span class="object-name iteration">{[this.trimText(values.data.Iteration, 25, "Unscheduled")]}</span>',"<tpl else>",'<div class="percent-done-wrapper">{[this.getPercentDoneByStoryCount(values)]}</div>',"</div>",'<tpl if="this.hasReleaseAttr(values.data)">','<span class="field-label">Release:</span>  <span class="object-name release">{[this.trimText(values.data.Release, 25, "Unscheduled")]}</span>',"<tpl else>","<span>&nbsp;</span>","</tpl>","</tpl>","</div>",{isUserStory:function(a){return"hierarchicalrequirement"===a.tplType},getFormattedIdTemplate:function(a){return Ext.create("Rally.ui.renderer.template.FormattedIDTemplate",{showIcon:!0,showHover:!1}).apply(a)},getScheduleState:function(a){return Ext.create("Rally.ui.renderer.template.ScheduleStateTemplate",{field:a.getField("ScheduleState")}).apply(a.data)},getPercentDoneByStoryCount:function(a){return Ext.create("Rally.ui.renderer.template.progressbar.PercentDoneByStoryCountTemplate",{field:a.getField("PercentDoneByStoryCount"),record:a}).apply(a.data)},trimText:function(a,b,c){return a&&a.Name?Ext.String.ellipsis(a.Name,b):c},hasReleaseAttr:function(a){return a.hasOwnProperty("Release")}}),depRowTpl:Ext.create("Ext.XTemplate",'<div class="dependency-row ts-dependent-story">','<div class="identifier">','<span class="{[this.getDependencyIconClass(values.data)]}"></span>','{[this.getFormattedIdTemplate(values.data)]} <span class="object-name dependency-title">{[this.trimText(values.data, 40, "")]}</span>',"</div>",'<div class="status">','<tpl if="this.isUserStory(values)">',"{[this.getScheduleState(values)]}","</div>",'<span class="field-label">Iteration:</span> <span class="object-name iteration">{[this.trimText(values.data.Iteration, 25, "Unscheduled")]}</span>',"<tpl else>",'<div class="percent-done-wrapper">{[this.getPercentDoneByStoryCount(values)]}</div>',"</div>",'<tpl if="this.hasReleaseAttr(values.data)">','<span class="field-label">Release:</span>  <span class="object-name release">{[this.trimText(values.data.Release, 25, "Unscheduled")]}</span>',"<tpl else>","<span>&nbsp;</span>","</tpl>","</tpl>","</div>",{getDependencyIconClass:function(a){return"Predecessors"==a._dependencyType?"icon-predecessor":"icon-successor"},isUserStory:function(a){return!0},getFormattedIdTemplate:function(a){return Ext.create("Rally.ui.renderer.template.FormattedIDTemplate",{showIcon:!0,showHover:!1}).apply(a)},getScheduleState:function(a){return Ext.create("Rally.ui.renderer.template.ScheduleStateTemplate",{field:a.getField("ScheduleState")}).apply(a.data)},getPercentDoneByStoryCount:function(a){return Ext.create("Rally.ui.renderer.template.progressbar.PercentDoneByStoryCountTemplate",{field:a.getField("PercentDoneByStoryCount"),record:a}).apply(a.data)},trimText:function(a,b,c){return a&&a.Name?Ext.String.ellipsis(a.Name,b):c},hasReleaseAttr:function(a){return a.hasOwnProperty("Release")}}),noneRowTpl:Ext.create("Ext.XTemplate",'<div class="dependency-row ts-dependent-story">','<div class="identifier">','<span class="{[this.getDependencyIconClass(values)]}"></span>',"None","</div>","</div>",{getDependencyIconClass:function(a){return"Predecessors"==a._dependencyType?"icon-predecessor":"icon-successor"}})}),Ext.define("StoryFeatureCard",{extend:"Rally.ui.cardboard.Card",alias:"widget.storyfeaturecard",hidden:!1,lowestPiTypeName:"Feature",initComponent:function(){this.hidden=this.isHiddenFunc(this),this.callParent(arguments),this.feature=this.record.get(this.lowestPiTypeName),this.hidden||this.on("ready",this._onReady,this)},setupPlugins:function(){return[{ptype:"rallycardpopover"}]},reRender:function(a){if(this.hidden){var b=this.getVisibleCard(this);b.reRender(a),b._onReady(b)}else this.callParent(arguments),this._onReady(this)},_onReady:function(a){var b=this.getAllFeatureStories(this);this.storyCount=b.length,this.acceptedStoryCount=0,this.storiesHaveDependencies=!1,_.each(b,function(a){a.get("AcceptedDate")&&(this.acceptedStoryCount=this.acceptedStoryCount+1);var b=a.get("PredecessorsAndSuccessors");b&&b.Count&&(this.storiesHaveDependencies=!0)},this),this.update(this._buildFinalHtml()),this._addFinalListeners()},_getFeatureColor:function(){var a={tag:"div",cls:"ts-artifact-color"};return this.feature.DisplayColor&&(a.style={backgroundColor:this.feature.DisplayColor}),Ext.DomHelper.createHtml(a)},_buildHtml:function(){return this._buildInitialHtml()},_buildInitialHtml:function(){var a=(this.getRecord(),[]);return a.push('<div class="ts-card-table-ct"><table class="ts-card-table"><tr>'),a.push('<td class="ts-card-content">'+this._getFeatureColor()+"</td>"),a.push('<td class="ts-card-content"><div class="field-content">'+this.feature.FormattedID+"</div></td>"),a.push("</tr></table>"),a.join("\n")},_buildFinalHtml:function(a){var b=this.getRecord(),c=b.get(this.lowestPiTypeName),d=[];d.push('<div class="ts-card-table-ct"><table class="ts-card-table"><tr>'),d.push('<td class="ts-card-content">'+this._getFeatureColor()+"</td>"),d.push('<td class="ts-card-content ts-formatted-id"><div class="field-content">'+this.feature.FormattedID+"</div></td>"),d.push('<td class="ts-card-content ts-card-icons">'),this.storiesHaveDependencies&&d.push('<span class="field-content FeatureStoriesPredecessorsAndSuccessors icon-children"></span>');var e=c.Predecessors,f=c.Successors;return(e&&e.Count||f&&f.Count)&&d.push('<span class="field-content FeaturePredecessorsAndSuccessors icon-predecessor"></span>'),d.push("</td>"),d.push('<td class="ts-card-content ts-accepted-count"><span class="field-content">'+this.acceptedStoryCount+" / "+this.storyCount+"</span></td>"),d.push("</tr></table>"),d.join("\n")},_addFinalListeners:function(){var a=this.getEl(),b=a.down(".ts-card-table");b&&b.on("click",function(a,b,c){this.fireEvent("story",this)},this);var c=a.down(".FeatureStoriesPredecessorsAndSuccessors");c&&c.on("click",function(a,b,c){return this.fireEvent("fieldclick","FeatureStoriesPredecessorsAndSuccessors",this),!1},this,{card:this,stopPropagation:!0});var d=a.down(".FeaturePredecessorsAndSuccessors");d&&d.on("click",function(){return this.fireEvent("fieldclick","FeaturePredecessorsAndSuccessors",this),!1},this,{card:this,stopPropagation:!0})}}),Ext.define("TsGridboardProjectScope",{alias:"plugin.tsgridboardprojectscope",extend:"Ext.Component",mixins:["Ext.AbstractPlugin","Rally.ui.gridboard.plugin.GridBoardControlShowable"],stateEvents:["change"],value:!1,initComponent:function(){this.callParent(arguments),this.addEvents("ready","select")},init:function(a){this.cmp=a,this.showControl()},getControlCmpConfig:function(){return _.merge({xtype:"rallycombobox",id:"ignoreScopeControl",cls:"ts-scope-control",stateful:!1,displayField:"text",valueField:"value",value:this.value,storeConfig:{fields:["text","value"],data:[{text:"In Current Project(s)",value:!1},{text:"In Any Project",value:!0}]},listeners:{scope:this,change:function(a,b){this.value=b,this.saveState(),this.cmp.fireEvent("viewstatesave",this);var c=this;setTimeout(function(){c.fireEvent("select",b)},100)}},removeCls:function(a){var b=this,c=b.rendered?b.el:b.protoEl;return c&&c.removeCls.apply(c,arguments),b}},this.controlConfig)},initState:function(){this.callParent(arguments),this.fireEvent("ready",this)},getState:function(){var a=this.getControlCmp(),b={scope:this.value};return a&&(b={scope:a.getValue()}),b},applyState:function(a){this.value=a.scope;var b=this.getControlCmp();b&&b.setValue(this.value)},getCurrentView:function(){return this.getState()},setCurrentView:function(a){var b=(this.getControlCmp(),this.getStateId()),c=_.pick(a,"scope");Ext.applyIf(c,this.getState()),Ext.state.Manager.set(b,c)},getValue:function(){return this.value}}),Ext.define("Rally.technicalservices.HierarchyExporter",{mixins:{observable:"Ext.util.Observable"},records:void 0,constructor:function(a){this.mixins.observable.constructor.call(this,a),this.modelName=a.modelName,this.records=[],this.fileName=a.fileName||"export.csv",this.columns=a.columns||[{dataIndex:"FormattedID",text:"ID"},{dataIndex:"Name",text:"Name"}],this.portfolioItemTypeObjects=a.portfolioItemTypeObjects||[]},setRecords:function(a,b){this.records=(this.records||[]).concat(b)},"export":function(){this.fireEvent("exportupdate","Preparing export data");var a=this.columns,b=this._buildHierarchy(),c=this._getExportableHierarchicalData(b,a),d=this.modelName.toLowerCase();b.length>0&&(d=b[0]._type),a=this._getAncestorTypeColumns(d).concat(a);var e=this._transformDataToDelimitedString(c,a);this.saveCSVToFile(e,this.fileName),this.fireEvent("exportcomplete")},_buildHierarchy:function(){var a=[],b=_.reduce(this.records,function(a,b){var c=b.get("ObjectID");return a[c]=b.getData(),a[c].loadedChildren=[],a},{});this.records=null;for(var c in b){var d=b[c],e=d.Parent&&d.Parent.ObjectID||d.PortfolioItem&&d.PortfolioItem.ObjectID||d.WorkProduct&&d.WorkProduct.ObjectID||d.Requirement&&d.Requirement.ObjectID||d.TestCase&&d.TestCase.ObjectID;if(e&&b[e])b[e].loadedChildren.push(d);else{var f=d.Parent&&d.Parent.Parent&&d.Parent.Parent.ObjectID||null;f&&b[f]?b[f].loadedChildren.push(d):a.push(d)}}return a},_transformDataToDelimitedString:function(a,b){var c=[],d=",",e="\r\n",f=new RegExp(d+'|"|\r|\n',"g"),g=new RegExp("</?[^>]+>","g"),h=new RegExp("&nbsp;","ig"),i=_.map(b,function(a){return a.dataIndex}),j=_.pluck(b,"text");return c.push(j.join(d)),Ext.Array.each(a,function(a){var b=[];Ext.Array.each(i,function(c){var d=a[c];"Parent"===c&&(d=a[c]||a.PortfolioItem),d&&(g.test(d)&&(d=d.replace("<br>","\r\n"),d=Ext.util.Format.htmlDecode(d),d=Ext.util.Format.stripTags(d)),h.test(d)&&(d=d.replace(h," ")),f.test(d)&&(d=d.replace(/\"/g,'""'),d=Ext.String.format('"{0}"',d))),b.push(d)},this),c.push(b.join(d))},this),c.join(e)},_getExportableHierarchicalData:function(a,b){var c=[];return _.each(a,function(a){var d={},e=this._getExportDataRow(a,b,d);c.push(e),this._addExportChildren(a,c,b,d)},this),c},_addExportChildren:function(a,b,c,d){var e=Ext.clone(d),f=this;Ext.isEmpty(e[a._type])&&(e[a._type]=a.FormattedID);var g=a.loadedChildren;g&&g.length>0&&_.each(g,function(a){var d=this._getExportDataRow(a,c,e),g=d._type;Ext.isEmpty(e[g])||(d[g]=e[g]),b.push(d),f._addExportChildren(a,b,c,e)},this)},getTypePathDisplayName:function(a){if("hierarchicalrequirement"===a.toLowerCase())return"User Story";if("task"===a.toLowerCase())return"Task";if("defect"===a.toLowerCase())return"Defect";if("testcase"===a.toLowerCase())return"Test Case";var b="";return Ext.Array.each(this.portfolioItemTypeObjects,function(c){return c.get("TypePath").toLowerCase()===a.toLowerCase()?(b=c.get("Name"),!1):void 0}),b},_getExportDataRow:function(a,b,c){var d=Ext.clone(c),e=a._type;return d[e]=a.FormattedID,d.type=this.getTypePathDisplayName(a._type),d._type=a._type,_.each(b,function(b){var c=b.dataIndex||null;if(c){var e=a[c];if("Parent"===c&&(e=a[c]||a.PortfolioItem),Ext.isObject(e))if(e._tagsNameArray&&e._tagsNameArray.length>0){var f=_.pluck(e._tagsNameArray,"Name");d[c]=f.join(",")}else e.FormattedID?d[c]=e.FormattedID+": "+e._refObjectName:d[c]=e._refObjectName;else Ext.isDate(e)?d[c]=Rally.util.DateTime.formatWithDefaultDateTime(e):d[c]=e}}),d},_getAncestorTypeColumns:function(a){var b=a.toLowerCase(),c=[];if("hierarchicalrequirement"==b||Ext.String.startsWith(b,"portfolioitem")){var d=this.portfolioItemTypeObjects,e=-1;Ext.Array.each(d,function(b,c){b.get("TypePath").toLowerCase()===a.toLowerCase()&&(e=c)}),c.push({dataIndex:"hierarchicalrequirement",text:"User Story"}),e>=0&&(c=c.concat(Ext.Array.map(d.slice(0,e+1),function(a){return{dataIndex:a.get("TypePath").toLowerCase(),text:a.get("Name")}})),c.push({dataIndex:"type",text:"Artifact Type"})),c.reverse()}return c},saveCSVToFile:function(a,b,c){void 0===c&&(c={type:"text/csv;charset=utf-8"}),this.saveAs(a,b,c)},saveAs:function(a,b){if(Ext.isIE9m)return void Rally.ui.notify.Notifier.showWarning({message:"Export is not supported for IE9 and below."});var c=null;try{c=new Blob([a],{type:"text/plain"})}catch(d){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,window.BlobBuilder&&"TypeError"==d.name&&(bb=new BlobBuilder,bb.append([a]),c=bb.getBlob("text/plain"))}if(!c)return void Rally.ui.notify.Notifier.showWarning({message:"Export is not supported for this browser."});var e=b;if(Ext.isIE10p)return void window.navigator.msSaveOrOpenBlob(c,e);var f=this.createObjectURL(c);if(f){var g=document.createElement("a");"download"in g?g.download=e:g.target="_blank",g.innerHTML="Download File",g.href=f,Ext.isChrome||(g.onclick=this.destroyClickedElement,g.style.display="none",document.body.appendChild(g)),g.click()}else Rally.ui.notify.Notifier.showError({message:"Export is not supported "})},createObjectURL:function(a){return window.webkitURL?window.webkitURL.createObjectURL(a):window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(a):null},destroyClickedElement:function(a){document.body.removeChild(a.target)}}),Ext.define("Rally.technicalservices.HierarchyLoader",{storyModelName:"hierarchicalrequirement",taskModelName:"task",mixins:{observable:"Ext.util.Observable"},model:void 0,filters:void 0,fetch:void 0,childModels:void 0,sorters:void 0,maxParallelCalls:6,constructor:function(a){this.mixins.observable.constructor.call(this,a),this.portfolioItemTypes=a.portfolioItemTypes||[],this.model=a.model||null,this.fetch=a.fetch||[],this.filters=a.filters||[],this.loadChildModels=a.loadChildModels||[],this.sorters=a.sorters||[]},load:function(){if(!this.model)return void this.fireEvent("hierarchyloaderror","No model specified.");if(0===this.portfolioItemTypes.length)return void this.fireEvent("hierarchyloaderror","Portfolio Item Types not initialized.");if(!(this.loadChildModels instanceof Array))return void this.fireEvent("hierarchyloaderror","No child models specified.");for(var a=[],b=0;b<this.loadChildModels.length+4;b++)a.push(this.fetchNextLevel);Deft.Chain.pipeline(a,this).then({success:function(){this.fireEvent("hierarchyloadcomplete")},failure:function(a){this.fireEvent("hierarchyloaderror",a)},scope:this})},fetchNextLevel:function(a){if(!a)return this.fetchRoot();if(a=_.flatten(a),a.length>0&&Ext.isFunction(a[0].get)){var b=a[0].get("_type"),c=Ext.Array.unique(Ext.Array.map(a,function(a){return a.get("_type")}));this.fireEvent("hierarchyloadartifactsloaded",b,a);var d=_.map(this.portfolioItemTypes,function(a){return a.get("TypePath").toLowerCase()}),e=_.indexOf(d,b);return 0===e&&Ext.Array.contains(this.loadChildModels,this.storyModelName)?this.fetchUserStories(a):e>0&&Ext.Array.contains(this.loadChildModels,d[e-1])?this.fetchPortfolioItems(d[e-1],a):this.fetchChildrenFromMultipleTypes(c,a)}return[]},fetchRoot:function(){var a=this.fetch.concat(this.getRequiredFetchFields(this.model));this.fireEvent("statusupdate","Loading artifacts");var b={model:this.model,fetch:a,filters:this.filters,sorters:this.sorters,context:this.context};return this.fetchWsapiRecords(b)},fetchPortfolioItems:function(a,b){var c=this.fetch.concat(this.getRequiredFetchFields(a)),d=this._getChunks(b,"Children","Count");return this.fetchChunks(a,c,d,"Parent.ObjectID",Ext.String.format("Please Wait... Loading Children for {0} Portfolio Items",b.length))},_getChunks:function(a,b,c){var d=[],e=0,f=100,g=200,h=0;return d[h]=[],_.each(a,function(a){var i=a.get(b);c&&i&&(i=i[c]),i>0&&(e+=i,(e>g||d[h].length>=f)&&(h++,d[h]=[],e=0),d[h].push(a.get("ObjectID")))}),d},fetchUserStories:function(a){var b=this.storyModelName,c=this.fetch.concat(this.getRequiredFetchFields(b)),d=this._getChunks(a,"LeafStoryCount"),e=this.portfolioItemTypes[0].get("Name").replace(/\s/g,"")+".ObjectID";return this.fetchChunks(b,c,d,e,Ext.String.format("Please Wait... Loading User Stories for {0} Portfolio Items",a.length))},fetchChildrenFromMultipleTypes:function(a,b){var c=[];return Ext.Array.map(a,function(a){if(child_types=this.getAllowedChildTypes(a),child_types.length>0){var d=Ext.Array.filter(b,function(b){return b.get("_type")==a},this);c.push(function(){return this.fetchChildrenOfMultipleTypes(d)})}},this),0===c.length?[]:Deft.Chain.sequence(c,this)},fetchChildrenOfMultipleTypes:function(a){var b=a[0].get("_type"),c=this.getAllowedChildTypes(b),d=Ext.Array.map(c,function(b){return function(){return this.fetchChildren(b,a)}},this);return Deft.Chain.sequence(d,this)},fetchChildren:function(a,b){var c=this.fetch.concat(this.getRequiredFetchFields(a)),d=b[0].get("_type"),e=this.getChildFieldFor(d,a),f=this._getChunks(b,e,"Count"),g=this.getParentFieldFor(a,d);return this.fetchChunks(a,c,f,g+".ObjectID",Ext.String.format("Please Wait... Loading {0} for {1} items",e,b.length))},fetchChunks:function(a,b,c,d,e){if(!c||0===c.length)return[];if(0===c[0].length)return[];this.fireEvent("statusupdate",e);var f=[];return _.each(c,function(c){var e=_.map(c,function(a){return{property:d,value:a}}),g={model:a,fetch:b,sorters:[{property:"TaskIndex",direction:"ASC"},{property:"DragAndDropRank",direction:"ASC"}],filters:Rally.data.wsapi.Filter.or(e),context:{project:null}};f.push(function(){return this.fetchWsapiRecords(g)})}),this.throttle(f,this.maxParallelCalls,this)},fetchWsapiRecords:function(a){var b=Ext.create("Deft.Deferred");return a.compact=!1,a.limit="Infinity",a.allowPostGet=!0,Ext.create("Rally.data.wsapi.Store",a).load({callback:function(a,c){c.wasSuccessful()?b.resolve(a):b.reject("fetchWsapiRecords error: "+c.error.errors.join(","))},scope:this}),b},getChildFieldFor:function(a,b){if("hierarchicalrequirement"===a.toLowerCase()||"userstory"===a.toLowerCase()){if("task"==b.toLowerCase())return"Tasks";if("defect"==b.toLowerCase())return"Defects";if("testcase"==b.toLowerCase())return"TestCases";if("hierarchicalrequirement"==b.toLowerCase())return"Children"}if("defect"===a.toLowerCase()){if("task"==b.toLowerCase())return"Tasks";if("testcase"==b.toLowerCase())return"TestCases"}return"testcase"===a.toLowerCase()&&"defect"==b.toLowerCase()?"Defects":/portfolioitem/.test(a.toLowerCase())&&"hierarchicalrequirement"==b.toLowerCase()?"UserStories":null},getParentFieldFor:function(a,b){if("hierarchicalrequirement"===b.toLowerCase()||"userstory"===b.toLowerCase()){if("task"==a.toLowerCase())return"WorkProduct";if("defect"==a.toLowerCase())return"Requirement";if("testcase"==a.toLowerCase())return"WorkProduct";if("hierarchicalrequirement"==a.toLowerCase())return"Parent"}if("defect"===b.toLowerCase()){if("task"==a.toLowerCase())return"WorkProduct";if("testcase"==a.toLowerCase())return"WorkProduct"}return"testcase"===b.toLowerCase()&&"defect"==a.toLowerCase()?"TestCase":/portfolioitem/.test(b.toLowerCase())&&"hierarchicalrequirement"==a.toLowerCase()?"PortfolioItem":null},getAllowedChildTypes:function(a){var b=[],c=this.loadChildModels;a.toLowerCase()===this.storyModelName.toLowerCase()&&(b=["task","defect","testcase",this.storyModelName.toLowerCase()]),"defect"===a.toLowerCase()&&(b=["task","testcase"]),"testcase"===a.toLowerCase()&&(b=["defect"]);var d=Ext.Array.intersect(b,c);return d},getRequiredFetchFields:function(a){return/^portfolioitem/.test(a.toLowerCase())?["Children","LeafStoryCount","Parent","ObjectID","UserStories"]:a.toLowerCase()===this.storyModelName?["FormattedID","Children","Tasks","Parent","PortfolioItem","HasParent","ObjectID","TestCases","Defects"]:["ObjectID","WorkProduct","Defects","Tasks","TestCases","Requirement","TestCase","FormattedID"]},throttle:function(a,b,c){if(0>=b||a.length<b)return Deft.promise.Chain.parallel(a,c);for(var d=[],e=[],f=-1,g=0;g<a.length;g++)g%b===0&&(f++,e[f]=[]),e[f].push(a[g]);return _.each(e,function(a){d.push(function(){return Deft.promise.Chain.parallel(a,c)})}),Deft.Promise.reduce(d,function(a,b){return Deft.Promise.when(b.call(c)).then(function(b){return a=a.concat(b||[])})},[])}}),Ext.override(Rally.ui.gridboard.plugin.GridBoardFieldPicker,{gridFieldBlackList:["Changesets","Children","ObjectID","Predecessors","RevisionHistory","Subscription","Successors","TaskIndex","Workspace","VersionId"]}),Ext.override(Rally.ui.inlinefilter.PropertyFieldComboBox,{defaultWhiteListFields:["Milestones","Tags"]}),Ext.override(Rally.ui.gridboard.SharedViewComboBox,{initComponent:function(){this.callParent(arguments),this.cmp.un("viewstatesave",this._onCmpViewStateSave,this),this.cmp.on("viewstatesave",this._onCmpViewStateSave,this)}}),Ext.override(Rally.ui.cardboard.plugin.CardPopover,{showFeaturePredecessorsAndSuccessors:function(){return this._createPopover({field:"PredecessorsAndSuccessors",title:"Portfolio Item Dependencies",record:this.card.getFeature(this.card),offsetFromTarget:[{x:0,y:-8},{x:15,y:0},{x:5,y:15},{x:-15,y:0}],target:this.card.getEl().down(".field-content.FeaturePredecessorsAndSuccessors")})},showFeatureStoriesPredecessorsAndSuccessors:function(){var a=this.card.getAllFeatureStories(this.card);return this._createPopover({field:"FeatureStoriesDependenciesPopover",record:this.card.getRecord(),stories:a,offsetFromTarget:[{x:0,y:-8},{x:15,y:0},{x:5,y:15},{x:-15,y:0}],target:this.card.getEl().down(".field-content.FeatureStoriesPredecessorsAndSuccessors")})}}),Rally.ui.popover.PopoverFactory.popovers.FeatureStoriesDependenciesPopover=function(a){return Ext.create("FeatureStoriesDependenciesPopover",this._getConfig(a))},Ext.define("TsExportGrid",{extend:"Ext.Component",getExportMenuItems:function(){var a=[],b=[this.model];return a=[{text:"Export Portfolio Items...",handler:this._export,scope:this,childModels:b},{text:"Export Portfolio Items and User Stories...",handler:this._export,scope:this,childModels:b.concat(["hierarchicalrequirement"])},{text:"Export Portfolio Items, User Stories and Tasks...",handler:this._export,scope:this,childModels:b.concat(["hierarchicalrequirement","task"])},{text:"Export Portfolio Items and Child Items...",handler:this._export,scope:this,childModels:b.concat(["hierarchicalrequirement","task","defect","testcase"])}]},_getGrid:function(){return Rally.getApp().down("#"+this.gridId)},_export:function(a){var b=this._getExportColumns(),c=this._getExportFetch(),d=this._getExportFilters(),e=this.model,f=a.childModels,g=this._getExportSorters(),h=Ext.create("Rally.technicalservices.HierarchyExporter",{modelName:e,fileName:"hierarchy-export.csv",columns:b,portfolioItemTypeObjects:this.portfolioItemTypes});h.on("exportupdate",this._showStatus,this),h.on("exporterror",this._showError,this),h.on("exportcomplete",this._showStatus,this);var i=Ext.create("Rally.technicalservices.HierarchyLoader",{model:e,fetch:c,filters:d,sorters:g,loadChildModels:f,portfolioItemTypes:this.portfolioItemTypes,context:this.dataContext});i.on("statusupdate",this._showStatus,this),i.on("hierarchyloadartifactsloaded",h.setRecords,h),i.on("hierarchyloadcomplete",h["export"],h),i.on("hierarchyloaderror",this._showError,this),i.load()},_getExportColumns:function(){var a=this._getGrid();return a?_.filter(a.getGridOrBoard().columns,function(a){return a.dataIndex&&"DragAndDropRank"!=a.dataIndex&&a.xtype&&"rallytreerankdraghandlecolumn"!=a.xtype&&"rallyrowactioncolumn"!=a.xtype&&"&#160;"!=a.text}):[]},_getExportFilters:function(){var a=this._getGrid(),b=[],c=Rally.getApp().getSetting("query");a.currentCustomFilter&&a.currentCustomFilter.filters&&(b=b.concat(a.currentCustomFilter.filters)),c&&b.push(Rally.data.wsapi.Filter.fromQueryString(c));var d=this.context.getTimeboxScope();return d&&d.isApplicable(a.getGridOrBoard().store.model)&&b.push(d.getQueryFilter()),b},_getExportFetch:function(){var a=_.pluck(this._getExportColumns(),"dataIndex");return Ext.Array.contains(a,"TaskActualTotal")&&a.push("Actuals"),a},_getExportSorters:function(){var a=this._getGrid();return a?a.getGridOrBoard().getStore().getSorters():void 0},_showError:function(a){Rally.ui.notify.Notifier.showError({message:a})},_showStatus:function(a){a?Rally.ui.notify.Notifier.showStatus({message:a,showForever:!0,closable:!1,animateShowHide:!1}):Rally.ui.notify.Notifier.hide()}}),Ext.define("release-tracking-with-filters",{extend:"Rally.app.App",componentCls:"app",layout:{type:"hbox",align:"stretch"},items:[{id:"left-area",region:"west",xtype:"panel",header:{cls:"ts-panel-header",padding:"0 0 15 0"},cls:"grid-area",title:Constants.PORTFOLIO_ITEMS,flex:1,layout:{type:"vbox",align:"stretch"},items:[{id:"grid-area",xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"}}]},{xtype:"splitter"},{id:"right-area",region:"center",xtype:"container",flex:2,type:"vbox",align:"stretch",overflowX:"auto",overflowY:"auto",items:[{id:"date-range-area",xtype:"container",layout:"hbox",padding:"15 0 15 20"},{id:"board-area",xtype:"container",flex:1,type:"vbox",align:"stretch",margin:"0 0 0 20"}]}],config:{defaultSettings:{showDependencyLines:!1}},integrationHeaders:{name:"release-tracking-with-filters"},launch:function(){var a=this.down("#date-range-area");a.add([{xtype:"rallydatefield",id:"start-date-picker",fieldLabel:Constants.START_DATE,labelWidth:120,labelCls:"date-label",margin:"0 10 0 0",listeners:{scope:this,change:function(a,b){this.timeboxStart=b,this._update()}}},{xtype:"rallydatefield",id:"end-date-picker",fieldLabel:Constants.END_DATE,labelWidth:30,labelCls:"date-label",margin:"0 10 0 0",listeners:{scope:this,change:function(a,b){this.timeboxEnd=b,this._update()}}}]);var b=this.getContext().getTimeboxScope();this._onTimeboxScopeChange(b);var c=[];c.push(Rally.data.util.PortfolioItemHelper.getPortfolioItemTypes().then({scope:this,success:function(a){return this.portfolioItemTypes=a,this.lowestPi=this.portfolioItemTypes[0],this.lowestPiTypePath=this.lowestPi.get("TypePath"),this.lowestPiTypeName=this.lowestPi.get("Name"),this.modelNames=[this.lowestPiTypePath],
Rally.data.wsapi.ModelFactory.getModel({type:this.lowestPiTypePath})}}).then({scope:this,success:function(a){this.lowestPiModel=a}})),Deft.promise.Promise.all(c).then({scope:this,success:this._update})},_update:function(){return this.setLoading(!0),this._createScopePlugin().then({scope:this,success:function(a){return this.scopeControlPlugin=a,this._updateIterationsStore()}}).then({scope:this,success:function(a){return this.currentIterations=a,this._updatePisStore()}}).then({scope:this,success:function(a){this._addPisGrid(this.piStore)}})},_createScopePlugin:function(){var a=Ext.create("Deft.Deferred");return Ext.create("TsGridboardProjectScope",{ptype:"tsgridboardprojectscope",headerPosition:"left",stateful:!0,stateId:this.getModelScopedStateId("project","scope"),listeners:{scope:this,ready:function(b){a.resolve(b)},select:function(a){this._update()}}}),a.promise},setLoading:function(a){if(this.down("#board-area").setLoading(a),this.grid){var b=this.grid.down("rallytreegrid");b&&b.setLoading(a)}},onResize:function(){this.callParent(arguments);var a=this.down("#grid-area"),b=this.down("rallygridboard");return void(a&&b&&b.setHeight(a.getHeight()))},_updatePisStore:function(){return this.currentDataContext=this.getContext().getDataContext(),this.searchAllProjects()&&(this.currentDataContext.project=null),this.currentPiQueries=this._getPiQueries(),Ext.create("Rally.data.wsapi.TreeStoreBuilder").build({models:[this.lowestPiTypePath],autoLoad:!1,fetch:Constants.FEATURE_FETCH,filters:this.currentPiQueries,enableHierarchy:!0,remoteSort:!0,context:this.currentDataContext,enablePostGet:!0,enableRootLevelPostGet:!0,clearOnLoad:!1}).then({scope:this,success:function(a){this.piStore=a}})},_getPiQueries:function(){var a=[];switch(this.timeboxType){case"release":a.push({property:"Release",value:this.timebox?this.timebox.get("_ref"):null});break;case"iteration":this.timebox?(a.push({property:"UserStories.Iteration.Name",value:this.timebox.get("Name")}),a.push({property:"UserStories.Iteration.StartDate",value:this.timebox.get("StartDate")}),a.push({property:"UserStories.Iteration.EndDate",value:this.timebox.get("EndDate")})):a.push({property:"UserStories.Iteration",value:null});break;case"milestone":a.push({property:"Milestones.ObjectID",value:this.timebox?this.timebox.get("ObjectID"):null})}return a},_updateIterationsStore:function(){var a=Rally.data.wsapi.Filter.and([{property:"EndDate",operator:">=",value:this.timeboxStart},{property:"StartDate",operator:"<=",value:this.timeboxEnd}]);return this.iterationsStore=Ext.create("Rally.data.wsapi.Store",{model:"Iteration",autoLoad:!1,filters:a,context:this.getContext().getDataContext()}),this.iterationsStore.load()},_getDefects:function(){},_addPisGrid:function(a){var b=this.down("#grid-area");b&&b.removeAll();var c=this.modelNames[0],d=this.getContext().getDataContext();d.project=null;var e=Ext.create("TsExportGrid",{model:this.lowestPiTypePath,gridId:"pisGrid",context:this.getContext(),dataContext:this.currentDataContext,portfolioItemTypes:this.portfolioItemTypes});this.grid=b.add({xtype:"rallygridboard",id:"pisGrid",context:this.getContext(),modelNames:this.modelNames,toggleState:"grid",height:b.getHeight(),listeners:{scope:this,viewchange:this._update,load:function(a){this._onGridLoad(a)}},plugins:[{ptype:"rallygridboardinlinefiltercontrol",inlineFilterButtonConfig:{stateful:!0,stateId:this.getModelScopedStateId(c,"filters"),modelNames:this.modelNames,inlineFilterPanelConfig:{quickFilterPanelConfig:{dataContext:d,portfolioItemTypes:this.portfolioItemTypes,modelName:this.lowestPiTypePath,whiteListFields:["Tags","Milestones"]}}}},{ptype:"rallygridboardfieldpicker",headerPosition:"left",modelNames:this.modelNames,stateful:!0,stateId:this.getModelScopedStateId(c,"fields")},this.scopeControlPlugin,{ptype:"rallygridboardsharedviewcontrol",sharedViewConfig:{stateful:!0,stateId:this.getModelScopedStateId(c,"views"),stateEvents:["select","beforedestroy"]}},{ptype:"rallygridboardactionsmenu",menuItems:e.getExportMenuItems(),buttonConfig:{iconCls:"icon-export"}}],gridConfig:{shouldShowRowActionsColumn:!1,enableBulkEdit:!1,enableEditing:!1,enableColumnMove:!1,enableInlineAdd:!1,enableRanking:!0,store:a,storeConfig:{context:this.currentDataContext,filters:this.currentPiQueries},listeners:{scope:this}}})},_onGridLoad:function(a){var b=a.getGridOrBoard().getStore(),c=b.getRootNode(),d=_.map(c.childNodes,function(a){return{property:this.lowestPiTypeName,operator:"=",value:a.get("_ref")}},this);this.storiesFilter=Rally.data.wsapi.Filter.or(d)||Rally.data.wsapi.Filter.and({property:"ObjectID",value:0}),this.storiesFilter=this.storiesFilter.and({property:"Parent",value:null});var e=this._addPisBoard(this.storiesFilter,this.currentIterations).then({scope:this,success:function(){this.setLoading(!1)}});return e},_onPiSelected:function(a){var b;this.selectedPi==a?(b=this.storiesFilter,delete this.selectedPi):(this.selectedPi=a,b=Rally.data.wsapi.Filter({property:this.lowestPiTypeName,operator:"=",value:a.get("_ref")})),this.buckets={},this.board.refresh({storeConfig:{filters:b}})},_addPisBoard:function(a,b){var c=Ext.create("Deft.Deferred"),d=this.down("#board-area");d.removeAll(),this.buckets={};var e=this.getContext(),f=(e.getDataContext(),_.sortBy(b,function(a){return a.get("EndDate")})),g=_.unique(f,function(a){return this._getIterationKey(a)},this),h=_.map(g,function(a){var b=a.get("StartDate").toLocaleDateString(),c=a.get("EndDate").toLocaleDateString(),d=new Ext.XTemplate('<div class="iteration-name">{name}</div><div class="iteration-dates">{start} - {end}</dev>').apply({name:a.get("Name"),start:b,end:c});return{xtype:"rallycardboardcolumn",columnHeaderConfig:{headerTpl:d,cls:"cardboard-column-header"},fields:[this.lowestPiTypeName],additionalFetchFields:Constants.STORIES_FETCH,getStoreFilter:function(){return[{property:"Iteration.Name",value:a.get("Name")},{property:"Iteration.StartDate",value:a.get("StartDate")},{property:"Iteration.EndDate",value:a.get("EndDate")}]},isMatchingRecord:function(a){return!0}}},this);return h.push({xtype:"rallycardboardcolumn",value:null,columnHeaderConfig:{headerTpl:Constants.UNSCHEDULED},fields:[this.lowestPiTypeName],additionalFetchFields:Constants.STORIES_FETCH}),this.board=d.add({xtype:"rallycardboard",type:["HierarchicalRequirement"],attribute:"Iteration",storeConfig:{filters:a,fetch:[this.lowestPiTypeName].concat(Constants.STORIES_FETCH),groupField:this.lowestPiTypeName,context:this.currentDataContext},listeners:{scope:this,boxready:function(){c.resolve()}},rowConfig:{field:"Project"},columns:h,cardConfig:{xtype:"storyfeaturecard",lowestPiTypeName:this.lowestPiTypeName,isHiddenFunc:this._isCardHidden.bind(this),getFeature:function(a){var b=a.getRecord(),c=b.get(this.lowestPiTypeName),d=this.piStore.getById(c);return d}.bind(this),getAllFeatureStories:function(a){var b=this._getCardsForCard(a);return _.map(b,function(a){return a.getRecord()})}.bind(this),getVisibleCard:function(a){var b=this._getCardsForCard(a);return b[0]}.bind(this),listeners:{scope:this,fieldclick:function(a,b){"FeatureStoriesPredecessorsAndSuccessors"==a&&this.getSetting("showDependencyLines")&&this.showStoryDependencyLines(b)},story:function(a){var b=a.getRecord(),c=b.get(this.lowestPiTypeName),d=this.piStore.getById(c),e=this.getContext().getDataContext();e.project=b.get("Project")._ref;var f=b.get("Iteration"),g=[];g=f?[{property:"Iteration.Name",value:f.Name},{property:"Iteration.StartDate",value:f.StartDate},{property:"Iteration.EndDate",value:f.EndDate}]:[{property:"Iteration",value:null}],g.push({property:"Project",value:e.project}),Rally.ui.popover.PopoverFactory.bake({field:"UserStory",record:d,target:a.getEl(),context:e,listViewConfig:{gridConfig:{storeConfig:{filters:g,context:e},columnCfgs:Constants.STORY_COLUMNS}}})}}}}),c.promise},showStoryDependencyLines:function(a){var b=a.getX(),c=a.getY(),d=a.getWidth(),e=a.getHeight(),f={x:d,y:e/2},g={x:0,y:e/2},h=this.down("#board-area");this.drawComponent&&h.remove(this.drawComponent);var i=this.down("#right-area").getEl(),j=i.getScroll(),k=[],l=-h.getX()+h.getEl().getMargin().left,m=0+j.top,n=this._getCardsForCard(a),o=_.map(n,function(d){var e=d.getRecord(),h=e.getCollection("Predecessors",{fetch:[this.lowestPiTypeName].concat(Constants.STORIES_FETCH)}).load().then({scope:this,success:function(d){_.each(d,function(d){var e=this._getRecordBucketKey(d);if(this.buckets.hasOwnProperty(e)){var h=this.buckets[e][0];if(h==a)return;var d={x:b,y:c},i={x:h.getX(),y:h.getY()};k.push({type:"circle",fill:"blue",radius:5,x:d.x+l+g.x,y:d.y+m+g.y}),k.push({type:"circle",fill:"blue",radius:5,x:i.x+l+f.x,y:i.y+m+f.y}),k.push({type:"path",path:Ext.String.format("M{0} {1} L {2} {3}",d.x+l+g.x,d.y+m+g.y,i.x+l+f.x,i.y+m+f.y),fill:"transparent",stroke:"blue","stroke-width":"1"})}},this)}}),i=e.getCollection("Successors",{fetch:[this.lowestPiTypeName].concat(Constants.STORIES_FETCH)}).load().then({scope:this,success:function(d){_.each(d,function(d){var e=this._getRecordBucketKey(d);if(this.buckets.hasOwnProperty(e)){var h=this.buckets[e][0];if(h==a)return;var d={x:b,y:c},i={x:h.getX(),y:h.getY()};k.push({type:"circle",fill:"blue",radius:5,x:d.x+l+f.x,y:d.y+m+f.y}),k.push({type:"circle",fill:"blue",radius:5,x:i.x+l+g.x,y:i.y+m+g.y}),k.push({type:"path",path:Ext.String.format("M{0} {1} L {2} {3}",d.x+l+f.x,d.y+m+f.y,i.x+l+g.x,i.y+m+g.y),fill:"transparent",stroke:"green","stroke-width":"1"})}},this)}});return Deft.promise.Promise.all([h,i])},this);Deft.promise.Promise.all(o).then({scope:this,success:function(){var a=0,b=0;this.drawComponent=Ext.create("Ext.draw.Component",{style:Ext.String.format("position:absolute; top:{0}px; left:{1}px;z-index:1000;pointer-events:none",b,a),itemId:"dependencies",id:"dep",viewBox:!1,floating:!1,height:h.getHeight(),width:h.getWidth(),items:k}),h.add(this.drawComponent),this.drawComponent.show()}})},_getCardBucketKey:function(a){var b=a.getRecord();return this._getRecordBucketKey(b)},_getRecordBucketKey:function(a){var b=this._getIterationKey(a.get("Iteration")),c=a.get("Project").ObjectID,d=a.get("Feature").ObjectID;return[d,c,b].join("-")},_getIterationKey:function(a){var b="";return a&&(b=a.get?a.get("Name")+a.get("StartDate").toISOString()+a.get("EndDate").toISOString():a.Name+a.StartDate+a.EndDate),b},_isCardHidden:function(a){var b=!1,c=this._getCardBucketKey(a);return this.buckets.hasOwnProperty(c)?(this.buckets[c].push(a),b=!0):this.buckets[c]=[a],b},_getCardsForCard:function(a){var b=this._getCardBucketKey(a),c=this.buckets[b];return c},viewChange:function(){this._buildGridStore()},getModelScopedStateId:function(a,b){return this.getContext().getScopedStateId(a+"-"+b)},getSettingsFields:function(){return[{xtype:"rallycheckboxfield",name:"showDependencyLines",fieldLabel:"(Experimental) Show Story Dependency Lines"}]},searchAllProjects:function(){return this.scopeControlPlugin.getValue()},onTimeboxScopeChange:function(a){this.callParent(arguments),this._onTimeboxScopeChange(a),this._update()},_onTimeboxScopeChange:function(a){a?(this.timeboxType=a.getType(),this.timebox=a.getRecord(),"release"==this.timeboxType?(this.timeboxStart=this.timebox?this.timebox.get("ReleaseStartDate"):new Date,this.timeboxEnd=this.timebox?this.timebox.get("ReleaseDate"):new Date):"milestone"==this.timeboxType?(this.timeboxStart=this.timebox?this.timebox.get("TargetDate"):new Date,this.timeboxEnd=this.timebox?this.timebox.get("TargetDate"):new Date):"iteration"==this.timeboxType&&(this.timeboxStart=this.timebox?this.timebox.get("StartDate"):new Date,this.timeboxEnd=this.timebox?this.timebox.get("EndDate"):new Date)):(this.timeboxStart=new Date,this.timeboxEnd=new Date),this._updateDateControls()},_updateDateControls:function(){var a=this.down("#start-date-picker");a.suspendEvents(),a.setValue(this.timeboxStart),a.resumeEvents();var b=this.down("#end-date-picker");b.suspendEvents(),b.setValue(this.timeboxEnd),b.resumeEvents()}});

               Rally.launchApp('release-tracking-with-filters', {
                   name: 'release-tracking-with-filters'
               });
        });
    </script>

    <style type="text/css">

.app {}

.tsinfolink {
    position: absolute;
    right: 0px;
    width: 14px;
    height: 14px;
    border-radius: 7px;
    text-align: center;
    color: white;
    background: #C0C0C0;
    border-style: solid;
    border-width: 1px;
    margin-top: 25px;
    margin-right: 5px;
    cursor: pointer;
}

.ts-page-label {
    font-weight: bold;
    font-size: medium;
}

.iteration-name {
    font-size: medium;
}

.iteration-dates {
    font-size: x-small;
    font-weight: normal;
}

.cardboard-column-header {
    margin-left: unset;
    margin-right: unset;
}

.date-label {
    font-size: 13px;
    font-weight: bold;
    font-family: ProximaNova, Helvetica, Arial;
    text-transform: uppercase;
}

.grid-area {
    background-color: rgb(244, 244, 244);
    padding: 15px;
    border: rgb(213, 213, 213);
    border-width: thin;
    border-style: solid;
    border-radius: 4px;
}

.ts-panel-header {
    background-color: rgb(244, 244, 244);
}

.ts-panel-header .x-panel-header-text {
    font-weight: bold;
}

.ts-artifact-color {
    width: 5px;
    height: 20px;
}

.ts-card-table div {
    font-weight: bold;
    font-size: 1.1em;
    color: #666;
}

.ts-scope-control {
    margin-top: 3px;
    margin-right: 9px;
}

.line {
    z-index: 10000;
    border-bottom-width: 2px;
    border-color: #000000;
    border-bottom-style: solid;
}

.line.predecessor {
    border-color: #FF0000;
    border-bottom-style: solid;
}

.line.successor {
    border-color: #00FF00;
    border-bottom-style: dashed;
}

.dependency-row.ts-dependent-story {
    padding-left: 40px !important;
}

.ts-dependent-story .icon-story {
    display: none;
}

.ts-card-content.ts-card-icons {
    min-width: 50px;
    text-align: center;
    cursor: pointer;
}

.ts-card-content.ts-accepted-count {
    width: 100%;
    color: #888;
    text-align: right;
    cursor: pointer;
}

    </style>

</head>
<body></body>
</html>